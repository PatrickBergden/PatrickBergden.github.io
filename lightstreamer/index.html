<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Go-Light <br>&mdash; en LightStreamer klient</title>
    <meta name="description" content="Bergden Finans - Reflektioner kring investering i aktier, råvaror, kryptovalutor och om att njuta av livet i största allmänhet." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Bergden Finans" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Bergden Finans" />
    <meta property="og:description" content="Reflektioner kring investering i aktier, råvaror, kryptovalutor och om att njuta av livet i största allmänhet." />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Bergden Finans" />
    <meta name="twitter:description" content="Reflektioner kring investering i aktier, råvaror, kryptovalutor och om att njuta av livet i största allmänhet." />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Finding The Way Home",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "Reflektioner kring investering i aktier, råvaror, kryptovalutor och om att njuta av livet i största allmänhet."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Bergden Finans" href="/rss.xml" />

    <!-- Equations using MathJax start -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });</script>
    <!-- Equations using MathJax stop -->

    <!-- needed? start-->
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async src="path-to-mathjax/MathJax.js?config=TeX-AMS_CHTML"></script>
<!-- needed? stop-->

</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Meny</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Stäng</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-fables " role="presentation"><a href="/tag/fables">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="/author/casper">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/rss.xml">Prenumerera</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/particles10.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-fiction">

        <header class="post-header">
            <h1 class="post-title">Go-Light <br>&mdash; en LightStreamer klient</h1>
            <section class="post-meta">
            <!-- <a href='/'>Patrick Bergden</a> -->
            <time class="post-date" datetime="2016-02-11">11 Feb 2016</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/utveckling'>Utveckling</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>IG erbjuder automatiserade interaktioner med deras servrar genom ett REST-baserat API.
För strömdata använder sig IG en websocket-lösning som kallas Lightstreamer.
Lightstreamer gör det möjligt för en klient att
via HTTP/HTTPS öppna en sk &#39;ström kanal&#39; till
en Lightstreamer server. Från denna server kan klienten
sedan ta emot realtidsdata, så som i vårt fall kan vara
det senaste priset på FING.</p>

<p>Vi upprättar alltså en web socket server-klient koppling
för att ta emot realtidsdata från IG&#39;s server.
Det ger oss möjligheten att bland annat hämta marknadsdata, öppna och stänga positioner, och en hel del annat.</p>

<p>I denna post bekantar jag mig med hur man kan interagera
med IG&#39;s server genom programspråket Go.</p>

<blockquote>
<p>Mycket av innehållet i denna post går att läsa sig till
i Lightstreamer dokumentationen. För en mer ingående
beskrivning rekomenderar jag att man läser den.</p>

<p>Det blir omständigt att hela tiden göra översättningar så
jag använder ofta det engelska namnet på många begrepp, koncept
eller teknologier....exempelvis <em>stream connection</em> istället för
<em>strömkoppling</em>.</p>
</blockquote>

<h2>Lightstreamer - strömdata över HTTP</h2>

<p>För att i realtid kunna ta emot marknadsdata och öppna/stänga
positioner på IGs servrar, så behöver jag öppna en HTTP (över TCP)
eller HTTPS (HTTP över SSL) websocket connection.</p>

<p>Genom denna websocket kan jag sedan authenticera mig så att
jag kommer åt min Depå. När jag gjort detta kan jag sedan
öppna ytterligare en connection - en control connection genom
vilken jag kan sända kommandon till IGs Lightstreamer-servrar.
Med hjälp av dessa kommandon kan jag administrera/styra innehållet
i min stream connection.</p>

<p>Det kommunikationsprotokoll vi använder oss av kallas</p>

<h3>Text Mode</h3>

<p>Lightstreamer erbjuder två olika kommunikationsprotokol
när en klient vill kommunicera med en server:
<em>JavaScript Mode</em> och <em>Text Mode</em>.</p>

<p>I Text Mode packeteras realtidsuppdateringar genom ett enkelt pipe-separerat (&#39;|&#39;), text-protokoll.
I denna post koncentrerar jag mig just på <em>Text Mode</em>.</p>

<h3>HTTP/HTTPS Requests</h3>

<p>All kommunikation med IGs Lightstreamer servrar sker alltså över HTTP eller HTTPS.
De två tillgängliga <em>request</em>-metoderna för HTTP kommunikation är <strong>POST</strong> och <strong>GET</strong>.</p>

<p>Jag använder <strong>HTTP</strong> för alla <em>control connections</em> då dessa requests saknar känsligt
innehåll och främst är till för att administrera strömkopplingarna.</p>

<p><strong>HTTPS</strong> bör användas för all data som är känslig och därför bör krypteras.
Det kan rör sig om marknadsdata från IGs servrar till mig, eller
mina användarkontouppgifter från mig till IGs servrar.</p>

<p>In enlighet med HTTP spec:en bör request-formen <strong>POST</strong> användas när en request
har sido-effekter på serversidan.</p>

<p><strong>GET</strong> requests är enklare och kan därför vara smidigare att använda under
testning.</p>

<h3>Servrar bakom en Load Balancer</h3>

<p>. p.5</p>

<p>På IGs hemsida finna några exempelklienter man kan ladda hem om man vill bekanta sig med hur interaktion med deras API kan gå till.
IG&#39;s klienter är främst skrivna i JavaScript, Java och Excel.</p>

<p>Eftersom att det tyvärr inte fanns någon klient för det programspråk jag helst använder (Go), så skrev jag en egen
Go-klient för att interagera med IG&#39;s LightStreamer servrar.</p>

<blockquote>
<p>Jag vill understryka att detta alltså varken är en klient skriven av Lightstreamer teamet eller IG själva. Jag skrev den för eget bruk och lämnar inga garantier för dessa funktionalitet, korrekthet eller prestanda.
Jag hade god hjälp av Lightstreamer klienten för Python när jag skrev min Go-klient.</p>
</blockquote>

<hr>

<h2>En rudimentär klient</h2>

<p>Denna klient är främst till för att visa på hur man kopplar upp sig till IG&#39;s
Lightstreamer server och genomför enklare interaktion.</p>

<h2>Om klienten</h2>

<p>Jag skrev den här klienten eftersom att Lightstream själva inte ännu erbjduer
en klient skriven i Go. Det finns klienter Java och Javascript.</p>

<h2>Workflow och Sessionstruktur</h2>

<p>Klienten gör i huvudsak följande:</p>

<ol>
<li>Kopplar upp sig mot en angiven Lightstreamer server och skapar en ny <a href="https://en.wikipedia.org/wiki/Session_(computer_science)">session</a>.</li>
<li>Upprättar en prenumeration på de objekt man önskar</li>
<li>Meddelar när klienten tar emot den real-tids-data som servern skickar</li>
<li>Avbryter prenumerationen när sessionen är klar</li>
<li>Bryter kopplingen mot servern</li>
</ol>

<p>Här nedan beskriver jag lite hur klientens kod ser ut.</p>

<h3><a name="abcd">Session</a></h3>

<p><strong>LSClient</strong> är en funktion som implementerar Lightstreamer Text Mode Protocol för
hantering av HTTP request och response för korrekt kommunikation mellan klienten och servern:</p>

<ol>
<li> func connect<br>
Upprätta en kontakt med servern och skapa en ny session.</li>
<li>  func disconnect<br>
Skicka en begäran till servern om att stänga sessionen.</li>
<li>  func subscribe<br>
Genomför en begäran (request) om att prenumerera på data från servern.</li>
<li>  func unsubscribe<br>
Avregistrera klienten (eller den prenumeratrions_nyckel det rör sig om) från servern.</li>
</ol>

<p>Så, hantering av sessionen (genom connect och disconnect) och hantering av prenumerationen av datan från servern (genom subscribe och unsubscribe).</p>

<h2>Subscriptions och Unsubscriptions</h2>

<p>För att kunna ta emot <em>realtidsuppdateringar</em> av t ex marknadsdata från IGs servrar
så måste jag skicka en <strong>subscription</strong> till servern - alltså tala om för servern:</p>

<ol>
<li>Vilka <strong>items</strong> data jag vill ha</li>
<li>Vilka samlingar av <strong>fält</strong> jag är intresserad av</li>
<li>Eventuellt även vilka <strong>data adapters</strong> som bidrar med de items jag är intresserad av.</li>
</ol>

<p>I en klient så är Subscription-funktionen den som sammanställer min begäran om vilken
data jag vill ha realtidsuppdateringar om.</p>

<p>När jag inte längre vill att IGs server skall skicka realtids-uppdateringar kring
en viss item, så talar jag om för servern att jag vill göra en <strong>unsubscribe</strong> av denna item.</p>

<hr>

<p>Abstraktionen innehåller prenumerationsdetaljer (<em>item names</em>, <em>field names</em>
    och <em>management mode</em>). Den specifierar även en <em>Data Adapter</em> som bidrar
    med alla <em>items</em></p>

<p>Vidare så underhåller den en intern lista som möjliggör registreringen av
generiska lyssnare (genom funktionen <em>addlistener</em>) som vill bli meddelade
när servern skickar ut realtids-uppdateringar.</p>

<p>När en <em>item</em> event skickas ut från servern så kommer Subscription funktionen
att meddela dessa vidare till de lyssnare som registrerats.</p>

<p>De huvudsakliga funktionerna är:</p>

<ul>
<li>  _decode<br>
Avkodar field value i enlighet med Lightserver Text Protocol spec:en.</li>
<li>  addlisterner<br></li>
<li>  notifyupdate<br>
Invokeras av LSClient varje gång Lightstreamer
server pushar ett nytt item event.</li>
</ul>

<p>Funktionen _decode hanterar även avkodning av de text meddelanden som servern
svarar med i enlighet med Lightserver Text Protocol spec.</p>

<h2>Uppkoppling mot IGs Lightstreamer server</h2>

<p>När vi vill koppla upp oss mot IGs Lightstreamer server så måste vi först
upprätta en ny <em>session</em>.</p>

<p>Detta gör vi genom att <em>LSClient</em> funktionen, som i sin tur tar hjälp av
<em>connect</em> funktionen.</p>

<p>LSClient tar två argument, IGs server adress och ett <em>Adapter Set</em> - vilket är</p>

<p>Här är ett exempel på detta:
<pre>
ig_lightstreamer_client = LSClient(&quot;http://push.lightstreamer.com:80&quot;, &quot;DEMO&quot;)
if err != nil {
    fmt.Println(&quot;Unable to connect to the IG Lightstreamer Server.&quot;)
}
else {
    ig_lightstreamer_client.connect()
}
</pre></p>

<h2>Subscribing</h2>

<p>Nästa steg är att upprätta en prenumeration (subscription)
som gör att IG&#39;s Lightstream server börjar sända en realtidsström
av data till vår klient.</p>

<p>För att åstadkomma detta behöver vi:</p>

<ol>
<li> Anropa Subscription funktionen (classen).<br>
Denna tar fyra argument.

<ul>
<li>  prenumarations formatet (&quot;MERGE&quot;)</li>
<li>  listan med artiklar vi vill prenumerera på</li>
<li>  listan med fält namn (field names)</li>
<li>  Data Adaptern (&quot;QUOTE_ADAPTER&quot;)</li>
</ul></li>
<li> Vi måste också upprätta en prenumerationslyssnare.<br>
Det gör vi med hjälp av funktionen <code>on_item_update</code>.
Denna funktion inkluderar eventuell aktion man vill avfyra
för varje ny artiel som uppdateras.
<strong>hade varit bra med ett exempel här!</strong></li>
<li> <code>on_item_update</code> anropas av Subscription funktionen med hjälp
en annan funktion <code>addListener</code>.</li>
<li> En subscribe funktion returnerar en prenumerations nyckel.
Denna används sedan för att både registrera prenumerationen
hos LSClient och för senare avregistrering.</li>
</ol>

<h2>Notifiering</h2>

<p>När väl prenumerationen mot IGs Lightstreamer server är aktiverad
så kan vi börja ta emot de realtids event som servern börjar pusha
genom den HTTP koppling vi upprättade under <a href="#abcd">konnektionsfasen</a>,  det första steget när vi startar en ny session.</p>

<h2>Koppla ifrån Servern</h2>

<p>Det är viktigt att koppla från servern på ett snyggt sätt.
Det gör vi med hjälp av <em>disconnect</em> metoden
<pre></p>

<h1>Disconnecting</h1>

<p>lightstreamer_client.disconnect()
</pre></p>

<h2>IG Data Adapter</h2>

<p>Okay, så vilken typ artiklar kan vi få från IGs Data Adapter?
Vilka fält(fields) kan vi läsa av och skicka vidare för hantering?</p>

<hr>

<h2>CLI Interagera med IG Lightstream servern</h2>

<p>I många avseende är det just en icke visuell interaktion
som är önskvärd -  gränssnitt</p>

<h3>Öppna en position</h3>

<h3>Stäng en position</h3>

<h3>Uppdatera en position</h3>

<h3>Implementera en Trailing Stop</h3>

<h3>Samla Live Data för post Analys</h3>

<h3>Styra interaktionen med en Konfigurationsfil</h3>

<h3>Alarm och email uppdateringar</h3>

<h3>Position Sizing genom Tröskel-Logik</h3>

<p>Vi kan stänga en position och sluta automattrada
ifall ett vist tröskelvärde överträffas.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/Esper" style="background-image: url(/assets/images/pk.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/Esper">Patrick Bergden</a></h4>
                
                
                    <p> Intreserad av allt som har med trading, programmering, kryptovalutor och blockchain att göra.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Gothenburg, Sweden</span> 
                    <span class="author-link icon-link"><a href="http://github.com/patrickbergden/"> github.com/patrickbergden/</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Go-Light <br>&mdash; en LightStreamer klient&amp;url=http://github.com/patrickbergden/lightstreamer"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://github.com/patrickbergden/lightstreamer"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://github.com/patrickbergden/lightstreamer"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/cover_dig_sig_01.jpg)" href="/private-blockchains-multichain">
            <section class="post">
                <h2>Privata Blockkedjor<br>&mdash; med MultiChain</h2>
                <p>Can it get any easier than this?: 1. Download Multichain 2. In the terminal: multichain-util...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/osx_wallpaper2.jpg)" href="/installera-go-osx">
            <section class="post">
                <h2>Go på OS X</h2>
                <p>Go är väldigt kinking kring hur och var det installeras på datorn. Denna post är...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Bergden Finans</a> &copy; 2016</section>
          <section class="poweredby">Inget på denna blogg är investeringsråd.</section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', '', 'auto');
	    ga('send', 'pageview');

     </script>
</body>
</html>
